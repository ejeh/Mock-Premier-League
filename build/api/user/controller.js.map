{"version":3,"sources":["../../../src/api/user/controller.js"],"names":["findOne","req","res","session","key","recordId","params","userId","locals","userType","ObjectId","isValid","User","findById","then","result","err","kind","message","findAll","find","limit","sort","createdAt","select","email","firstName","lastName","update","data","body","userEmail","record","newObject","updatedBy","updated","Date","now","toLowerCase","password","helper","hashPassword","findByIdAndUpdate","destroy","findByIdAndRemove","name"],"mappings":"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","sourcesContent":["import User, { ObjectId } from \"./model\";\nimport { success, fail, notFound } from \"../../services/responses\";\nimport * as helper from \"../../services/helpers\";\n\n// Retrieve a single record with a given userId\nexport function findOne(req, res) {\n  if (req.session.key) {\n    let recordId = req.params.userId || \"\";\n    const { userId, userType } = res.locals;\n    if (!userId || !userType)\n      return fail(res, 400, \"Invalid authentication credentials\");\n    if (userType !== \"user\")\n      return fail(\n        res,\n        422,\n        `Only Users are allowed to update this record not ${userType}`\n      );\n    if (!recordId) recordId = userId;\n    if (!ObjectId.isValid(recordId))\n      return fail(res, 422, \"Invalid record Id as request parameter\");\n    return User.findById(recordId)\n      .then(result => {\n        if (!result) return notFound(res, \"Error record not found.\");\n        return success(res, 200, result, \"retrieving record was successfully!\");\n      })\n      .catch(err => {\n        if (err.kind === \"ObjectId\") {\n          notFound(res, `Error retrieving record.\\r\\n${err.message}`);\n        }\n        return fail(res, 500, `Error retrieving record.\\r\\n${err.message}`);\n      });\n  } else {\n    return fail(res, 401, \"Session timeout, please re-login\");\n  }\n}\n\n// / Retrieve and return all records from the database.\nexport function findAll(req, res) {\n  if (req.session.key) {\n    return User.find()\n      .limit(4)\n      .sort({ createdAt: -1 })\n      .select({\n        // eslint-disable-next-line object-property-newline\n        email: true,\n        firstName: true,\n        lastName: true\n      })\n      .then(result =>\n        success(res, 200, result, \"retrieving record(s) was successfully!\")\n      )\n      .catch(err =>\n        fail(res, 500, `Error retrieving record(s).\\r\\n${err.message}`)\n      );\n  } else {\n    return fail(res, 401, \"Session timeout, please re-login\");\n  }\n}\n\n// Update a user\nexport async function update(req, res) {\n  if (req.session.key) {\n    const data = req.body || {};\n    const { userId, userType, userEmail } = res.locals;\n    if (!userId || !userType)\n      return fail(res, 400, \"Invalid authentication credentials\");\n    if (userType !== \"user\")\n      return fail(\n        res,\n        422,\n        `Only User are allowed to update this record not ${userType}`\n      );\n    if (!userEmail && !data.email)\n      return fail(res, 422, \"You must provide an alphanumeric email address\");\n\n    let record = {};\n    try {\n      record = await User.findById(userId);\n    } catch (err) {\n      return fail(res, 422, \"Error fetching User information\");\n    }\n    if (!record) return notFound(res, \"User not found\");\n\n    const newObject = {};\n    newObject.updatedBy = userId;\n    newObject.updated = Date.now();\n    if (data.firstName) newObject.firstName = data.firstName;\n    if (data.lastName) newObject.lastName = data.lastName;\n    if (!userEmail) newObject.email = data.email.toLowerCase();\n    if (data.password)\n      newObject.password = await helper.hashPassword(data.password);\n\n    return User.findByIdAndUpdate(userId, newObject, { new: true })\n      .then(result => {\n        if (!result)\n          return notFound(\n            res,\n            `Error: newly submitted record not found with id ${userId}`\n          );\n        return success(\n          res,\n          200,\n          result,\n          \"Record has been created successfully!\"\n        );\n      })\n      .catch(err =>\n        fail(\n          res,\n          500,\n          `Error updating record with id ${userId}.\\r\\n${err.message}`\n        )\n      );\n  } else {\n    return fail(res, 401, \"Session timeout, please re-login\");\n  }\n}\n\n// Delete a admin with the specified adminId in the request\nexport async function destroy(req, res) {\n  if (req.session.key) {\n    const recordId = req.params.userId || \"\";\n    if (!recordId) return fail(res, 400, \"No record Id as request parameter\");\n    if (!ObjectId.isValid(recordId))\n      return fail(res, 422, \"Invalid record Id as request parameter\");\n\n    const { userId, userType } = res.locals;\n    if (!userId || !userType)\n      return fail(res, 400, \"Invalid authentication credentials\");\n\n    if (userType === \"user\" && recordId === userId) {\n      // we are cool!\n    } else {\n      return fail(\n        res,\n        422,\n        `Only  User is allowed to delete this record not ${userType}`\n      );\n    }\n    return User.findByIdAndRemove(recordId)\n      .then(record => {\n        if (!record)\n          return notFound(res, `Record not found with id ${recordId}`);\n        return success(res, 200, [], \"Record deleted successfully!\");\n      })\n      .catch(err => {\n        if (err.kind === \"ObjectId\" || err.name === \"NotFound\") {\n          return notFound(\n            res,\n            `Error: record not found with id ${recordId}\\r\\n${err.message}`\n          );\n        }\n        return fail(\n          res,\n          500,\n          `Error: could not delete record with id ${recordId}\\r\\n${err.message}`\n        );\n      });\n  } else {\n    return fail(res, 401, \"Session timeout, please re-login\");\n  }\n}\n"],"file":"controller.js"}